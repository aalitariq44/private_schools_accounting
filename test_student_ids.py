#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุฎุชุจุงุฑ ูุธุงู ุฅูุดุงุก ูููุงุช ุงูุทูุงุจ
"""

import sys
import os
from pathlib import Path

# ุฅุถุงูุฉ ูุณุงุฑ ุงููุดุฑูุน
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

# ุชููุฆุฉ ุงููุณุงุฑุงุช
import config

from core.pdf.student_id_generator import generate_student_ids_pdf

def test_student_ids():
    """ุงุฎุชุจุงุฑ ุฅูุดุงุก ูููุงุช ุงูุทูุงุจ"""
    
    print("๐งช ุงุฎุชุจุงุฑ ูุธุงู ุฅูุดุงุก ูููุงุช ุงูุทูุงุจ...")
    
    # ุจูุงูุงุช ุทูุงุจ ุชุฌุฑูุจูุฉ
    test_students = [
        {
            "name": "ุฃุญูุฏ ูุญูุฏ ุนูู ุงูุณุงูุฑุงุฆู",
            "grade": "ุงูุตู ุงูุฃูู ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ูุงุทูุฉ ุญุณู ูุญููุฏ ุงูุฌุจูุฑู", 
            "grade": "ุงูุตู ุงูุซุงูู ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ูุญูุฏ ุนุจุฏุงููู ุฃุญูุฏ",
            "grade": "ุงูุตู ุงูุซุงูุซ ุงูุงุจุชุฏุงุฆู", 
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ููุฑ ุงููุฏู ุตุงูุญ ูุญูุฏ",
            "grade": "ุงูุตู ุงูุฑุงุจุน ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ุนูุงุฑ ุทุงุฑู ุญุณูู ุนูู",
            "grade": "ุงูุตู ุงูุฎุงูุณ ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ุฑูุง ุนุงุฏู ุตุงูุญ",
            "grade": "ุงูุตู ุงูุณุงุฏุณ ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ุญุณุงู ุงูุฏูู ูุญูุฏ ุนุจุฏุงูุฑุญูู",
            "grade": "ุงูุตู ุงูุฃูู ูุชูุณุท",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ุฒููุจ ุนูู ุญุณู",
            "grade": "ุงูุตู ุงูุซุงูู ูุชูุณุท",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ููุณู ุฅุจุฑุงููู ูุญูุฏ",
            "grade": "ุงูุตู ุงูุซุงูุซ ูุชูุณุท",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ูุฑูู ุนุจุฏุงููู ุตุงูุญ",
            "grade": "ุงูุตู ุงูุฃูู ุซุงููู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ุญูุฏุฑ ุนูุงุฑ ุทุงุฑู",
            "grade": "ุงูุตู ุงูุซุงูู ุซุงููู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "name": "ุณุงุฑุฉ ูุญููุฏ ุนูู",
            "grade": "ุงูุตู ุงูุซุงูุซ ุซุงููู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        }
    ]
    
    # ุชุญุฏูุฏ ูุณุงุฑ ุงูุฅุฎุฑุงุฌ
    output_path = project_root / "test_student_ids_output.pdf"
    
    print(f"๐ ุฅูุดุงุก ูููุงุช ูู {len(test_students)} ุทุงูุจ...")
    
    # ุฅูุดุงุก ุงููููุงุช
    success = generate_student_ids_pdf(
        test_students,
        str(output_path),
        "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ", 
        "ูููุฉ ุทุงูุจ"
    )
    
    if success:
        print(f"โ ุชู ุฅูุดุงุก ุงููููุงุช ุจูุฌุงุญ!")
        print(f"๐ ุงูููู: {output_path}")
        
        # ูุชุญ ุงูููู ุฅุฐุง ูุงู ููุฌูุฏุงู
        if output_path.exists():
            print(f"๐ ุญุฌู ุงูููู: {output_path.stat().st_size / 1024:.1f} KB")
            
            # ูุญุงููุฉ ูุชุญ ุงูููู
            try:
                import subprocess
                subprocess.Popen([str(output_path)], shell=True)
                print("๐ฅ๏ธ ุชู ูุชุญ ุงูููู...")
            except Exception as e:
                print(f"โ๏ธ ูู ูุชู ูุชุญ ุงูููู ุชููุงุฆูุงู: {e}")
        else:
            print("โ ุงูููู ุบูุฑ ููุฌูุฏ!")
            return False
            
    else:
        print("โ ูุดู ูู ุฅูุดุงุก ุงููููุงุช!")
        return False
    
    return True

def test_template_functions():
    """ุงุฎุชุจุงุฑ ูุธุงุฆู ุงููุงูุจ"""
    
    print("\n๐งช ุงุฎุชุจุงุฑ ูุธุงุฆู ุงููุงูุจ...")
    
    try:
        from templates.id_template import save_template_as_json, load_template_from_json, ensure_default_template
        
        # ุฅูุดุงุก ุงููุงูุจ ุงูุงูุชุฑุงุถู
        ensure_default_template()
        print("โ ุชู ุฅูุดุงุก ุงููุงูุจ ุงูุงูุชุฑุงุถู")
        
        # ุญูุธ ุงููุงูุจ ูู JSON
        template_file = project_root / "test_template.json"
        save_template_as_json(template_file)
        print(f"โ ุชู ุญูุธ ุงููุงูุจ: {template_file}")
        
        # ุชุญููู ุงููุงูุจ
        if template_file.exists():
            success = load_template_from_json(template_file)
            if success:
                print("โ ุชู ุชุญููู ุงููุงูุจ ุจูุฌุงุญ")
            else:
                print("โ ูุดู ูู ุชุญููู ุงููุงูุจ")
                
            # ุญุฐู ุงูููู ุงูุชุฌุฑูุจู
            template_file.unlink()
            print("๐๏ธ ุชู ุญุฐู ุงูููู ุงูุชุฌุฑูุจู")
        
        return True
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ูุธุงุฆู ุงููุงูุจ: {e}")
        return False

if __name__ == "__main__":
    print("๐ ุจุฏุก ุงุฎุชุจุงุฑ ูุธุงู ุฅูุดุงุก ูููุงุช ุงูุทูุงุจ\n")
    
    # ุงุฎุชุจุงุฑ ูุธุงุฆู ุงููุงูุจ
    template_success = test_template_functions()
    
    # ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููููุงุช
    ids_success = test_student_ids()
    
    print(f"\n๐ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:")
    print(f"   ๐ง ูุธุงุฆู ุงููุงูุจ: {'โ ูุฌุญ' if template_success else 'โ ูุดู'}")
    print(f"   ๐ ุฅูุดุงุก ุงููููุงุช: {'โ ูุฌุญ' if ids_success else 'โ ูุดู'}")
    
    if template_success and ids_success:
        print("\n๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช! ูุธุงู ุงููููุงุช ุฌุงูุฒ ููุงุณุชุฎุฏุงู.")
    else:
        print("\nโ๏ธ ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุดูุช. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก.")
