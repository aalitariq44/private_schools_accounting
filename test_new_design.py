#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุฎุชุจุงุฑ ุงูุชุตููู ุงูุฌุฏูุฏ ุงููุญุณูู ููููุงุช ุงูุทูุงุจ
"""

import sys
import os
from pathlib import Path

# ุฅุถุงูุฉ ูุณุงุฑ ุงููุดุฑูุน ุฅูู sys.path
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

from core.pdf.student_id_generator import generate_student_ids_pdf
from datetime import datetime

def test_new_design():
    """ุงุฎุชุจุงุฑ ุงูุชุตููู ุงูุฌุฏูุฏ ููููุงุช ุงูุทูุงุจ"""
    print("=== ุงุฎุชุจุงุฑ ุงูุชุตููู ุงูุฌุฏูุฏ ุงููุญุณูู ููููุงุช ุงูุทูุงุจ ===")
    
    # ุจูุงูุงุช ุทูุงุจ ููุงุฎุชุจุงุฑ ูุน ุฃุณูุงุก ูุฏุงุฑุณ ูุฎุชููุฉ
    test_students = [
        {
            "id": 1001,
            "name": "ุฃุญูุฏ ูุญูุฏ ุนูู ุงูุฎุทูุจ",
            "grade": "ุงูุฃูู ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูููุฑ ุงูุฃูููุฉ"
        },
        {
            "id": 1002,
            "name": "ูุงุทูุฉ ุญุณู ูุญููุฏ ุงูุณุนุฏู",
            "grade": "ุงูุซุงูู ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูุฃูู ุงูุฃูููุฉ"
        },
        {
            "id": 1003,
            "name": "ูุญูุฏ ุนุจุฏุงููู ุฃุญูุฏ ุงูุฒูุฑุงูู",
            "grade": "ุงูุซุงูุซ ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูุดุฑูู ุงูุฃูููุฉ"
        },
        {
            "id": 1004,
            "name": "ููุฑ ุงููุฏู ุตุงูุญ ุงูุนุชูุจู",
            "grade": "ุงูุฑุงุจุน ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงููุฌุงุญ ุงูุฃูููุฉ"
        },
        {
            "id": 1005,
            "name": "ุนูุงุฑ ุทุงุฑู ุญุณูู ุงููุญูุฏู",
            "grade": "ุงูุฎุงูุณ ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงูุฑุดูุฏ ุงูุฃูููุฉ"
        },
        {
            "id": 1006,
            "name": "ุฒููุจ ุนูู ุญุณุงู ุงูุฏูู",
            "grade": "ุงูุณุงุฏุณ ุงูุงุจุชุฏุงุฆู",
            "school_name": "ูุฏุฑุณุฉ ุงููุฌุฏ ุงูุฃูููุฉ"
        },
        {
            "id": 1007,
            "name": "ููุณู ุฅุจุฑุงููู ูุญูุฏ ุงูุนูู",
            "grade": "ุงูุฃูู ุงููุชูุณุท",
            "school_name": "ูุฏุฑุณุฉ ุงููุฌุฑ ุงูุฃูููุฉ"
        },
        {
            "id": 1008,
            "name": "ูุฑูู ุนุงุฏู ุตุงูุญ ุงูุจูุฑู",
            "grade": "ุงูุซุงูู ุงููุชูุณุท",
            "school_name": "ูุฏุฑุณุฉ ุงููุฏุงูุฉ ุงูุฃูููุฉ"
        }
    ]
    
    # ุฅูุดุงุก ุงุณู ููู ูุฑูุฏ
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    output_file = project_root / f"student_ids_new_design_{timestamp}.pdf"
    
    print(f"๐ ุฅูุดุงุก ููู: {output_file.name}")
    print(f"๐ ุนุฏุฏ ุงูุทูุงุจ: {len(test_students)}")
    
    # ุฅูุดุงุก PDF ูุน ุงูุชุตููู ุงูุฌุฏูุฏ
    # ุณูุณุชุฎุฏู ุงุณู ูุฏุฑุณุฉ ุนุงูุฉ ูู ุงูุจุฏุงูุฉ
    result = generate_student_ids_pdf(
        test_students,
        str(output_file),
        "ูุฏุฑุณุฉ ุนุงูุฉ",  # ูุฐุง ุณูุชู ุชุฌุงููู ูุฃู ูู ุทุงูุจ ูู ูุฏุฑุณุชู
        "ูููุฉ ุทุงูุจ"
    )
    
    if result:
        print(f"โ ุชู ุฅูุดุงุก ุงูููู ุจูุฌุงุญ!")
        print(f"๐ ุญุฌู ุงูููู: {output_file.stat().st_size / 1024:.2f} KB")
        print(f"๐ ุนุฏุฏ ุงูุตูุญุงุช ุงููุชููุน: {(len(test_students) + 7) // 8}")
        
        # ุนุฑุถ ูุงุฆูุฉ ุจุงูุทูุงุจ ูุงููุฏุงุฑุณ
        print("\n๐ ุงูุทูุงุจ ูุงููุฏุงุฑุณ ุงูููุถููุฉ:")
        for i, student in enumerate(test_students, 1):
            print(f"  {i:2d}. {student['name']}")
            print(f"      ๐ {student['grade']} - ๐ซ {student['school_name']}")
            print(f"      ๐ ุฑูู ุงููููุฉ: {student['id']}")
            print()
        
        print("\n๐จ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ ูู ุงูุชุตููู:")
        print("   โจ ุนููุงู 'ูููุฉ ุทุงูุจ' ุซุงุจุช ูููุจุฑุฒ ูู ุงูุฃุนูู")
        print("   ๐ซ ุงุณู ูุฏุฑุณุฉ ุงูุทุงูุจ ุงูุฎุงุตุฉ (ูููุณ ุงููุคุณุณุฉ ุงูุฑุฆูุณูุฉ)")
        print("   ๐ ุฎุทูุท ุฃูุจุฑ ูุฃูุถุญ ููุนูุงููู ุงูุฑุฆูุณูุฉ")
        print("   ๐ฏ ุชุฑุชูุจ ูุญุณูู ูุน ุชุณููุงุช ูุงุถุญุฉ")
        print("   ๐ ุฃููุงู ุฃูููุฉ ููุชูุงุณูุฉ")
        print("   ๐ ุฎุทูุท ูุงุตูุฉ ูุชุญุณูู ุงูุชูุธูู")
        print("   ๐ฆ ุฅุทุงุฑุงุช ูุญุณููุฉ ููุตูุฑุฉ ูุฑูุฒ QR")
        
        # ูุญุงููุฉ ูุชุญ ุงูููู
        try:
            os.startfile(str(output_file))
            print(f"\n๐ ุชู ูุชุญ ุงูููู ูููุนุงููุฉ")
        except Exception as e:
            print(f"\n๐ ููููู ูุชุญ ุงูููู ูุฏููุงู: {output_file}")
            
        return True
    else:
        print("โ ูุดู ูู ุฅูุดุงุก ุงูููู")
        return False

def test_single_school_cards():
    """ุงุฎุชุจุงุฑ ูููุงุช ููุฏุฑุณุฉ ูุงุญุฏุฉ ููุท"""
    print("\n=== ุงุฎุชุจุงุฑ ูููุงุช ูุฏุฑุณุฉ ูุงุญุฏุฉ ===")
    
    # ุจูุงูุงุช ุทูุงุจ ููุฏุฑุณุฉ ูุงุญุฏุฉ
    single_school_students = [
        {
            "id": 2001,
            "name": "ุฎุงูุฏ ุฃุญูุฏ ุงูุฑุงุดุฏ",
            "grade": "ุงูุฃูู ุงูุซุงููู",
            "school_name": "ูุฏุฑุณุฉ ุงูุญููุฉ ุงูุฃูููุฉ"
        },
        {
            "id": 2002,
            "name": "ุนุงุฆุดุฉ ูุญูุฏ ุงูุฒูุฑุงูู",
            "grade": "ุงูุซุงูู ุงูุซุงููู",
            "school_name": "ูุฏุฑุณุฉ ุงูุญููุฉ ุงูุฃูููุฉ"
        },
        {
            "id": 2003,
            "name": "ุนุจุฏุงูุฑุญูู ุณุนุฏ ุงููุทูุฑู",
            "grade": "ุงูุซุงูุซ ุงูุซุงููู",
            "school_name": "ูุฏุฑุณุฉ ุงูุญููุฉ ุงูุฃูููุฉ"
        }
    ]
    
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    output_file = project_root / f"single_school_ids_{timestamp}.pdf"
    
    result = generate_student_ids_pdf(
        single_school_students,
        str(output_file),
        "ูุฏุฑุณุฉ ุงูุญููุฉ ุงูุฃูููุฉ",
        "ูููุฉ ุทุงูุจ"
    )
    
    if result:
        print(f"โ ุชู ุฅูุดุงุก ููู ุงููุฏุฑุณุฉ ุงููุงุญุฏุฉ: {output_file.name}")
        try:
            os.startfile(str(output_file))
        except:
            pass
        return True
    else:
        print("โ ูุดู ูู ุฅูุดุงุก ููู ุงููุฏุฑุณุฉ ุงููุงุญุฏุฉ")
        return False

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ"""
    print("๐จ ุงุฎุชุจุงุฑ ุงูุชุตููู ุงูุฌุฏูุฏ ุงููุญุณูู ููููุงุช ุงูุทูุงุจ")
    print("=" * 60)
    
    success1 = test_new_design()
    success2 = test_single_school_cards()
    
    print("\n" + "=" * 60)
    if success1 and success2:
        print("๐ ุชู ุชุทุจูู ุงูุชุตููู ุงูุฌุฏูุฏ ุจูุฌุงุญ!")
        print("๐ ุงููุทููุจ ูููุฑุงุฌุนุฉ:")
        print("   ๐ ุชุญูู ูู ูุถูุญ ุงููุตูุต ูุญุฌู ุงูุฎุทูุท")
        print("   ๐จ ุชุฃูุฏ ูู ุฌูุงู ุงูุชุตููู ูุงูุชุฑุชูุจ")
        print("   ๐ ุชุญูู ูู ุฃู ุญุฌู ุงููููุฉ ูุงุฒุงู ุจุญุฌู ูุงุณุชุฑ ูุงุฑุฏ")
        print("   ๐ซ ุชุฃูุฏ ูู ุธููุฑ ุงุณู ูุฏุฑุณุฉ ุงูุทุงูุจ ุงูุตุญูุญุฉ")
    else:
        print("โ ููุงู ูุดููุฉ ุชุญุชุงุฌ ุฅูู ุญู")

if __name__ == "__main__":
    main()
