#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุฎุชุจุงุฑ ููุญุฏุซ ูุฏุนู ุงูุนุฑุจูุฉ ูู ุงููููุงุช ูุน ุญุงูุงุช ุงุฎุชุจุงุฑ ุฅุถุงููุฉ
"""

import os
import sys
from pathlib import Path

# ุฅุถุงูุฉ ูุณุงุฑ ุงููุดุฑูุน
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

# ุฅุนุฏุงุฏ ุงููุณุงุฑุงุช
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'private_schools_accounting.settings')

from core.pdf.student_id_generator import generate_student_ids_pdf, generate_single_student_id_preview

def test_all_text_elements():
    """ุงุฎุชุจุงุฑ ุฌููุน ุนูุงุตุฑ ุงููุต ูู ุงููููุฉ"""
    
    print("๐ ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ุนูุงุตุฑ ุงููุต ุงูุนุฑุจู ูู ุงููููุงุช")
    print("=" * 60)
    
    # ุจูุงูุงุช ุงุฎุชุจุงุฑ ุชุญุชูู ุนูู ูุตูุต ูุนูุฏุฉ
    complex_students = [
        {
            "name": "ุฃุญูุฏ ูุญูุฏ ุนูู ุงูุณุงูุฑุงุฆู ุงูุจุบุฏุงุฏู ุงููุฑุจูุงุฆู ุงููุฌูู ุงูููุตูู ุงูุจุตุฑู ุงูุนุฑุงูู",
            "grade": "ุงูุตู ุงูุฃูู ุงูุงุจุชุฏุงุฆู ุงููููุฐุฌู ูููุชููููู ูุงูููููุจูู"
        },
        {
            "name": "ูุงุทูุฉ ุงูุฒูุฑุงุก ุจูุช ุงูุฅูุงู ุนูู (ุนูููุง ุงูุณูุงู)",
            "grade": "ุงูุซุงูู ุงููุชูุณุท ุงูุนููู"
        },
        {
            "name": "ูุญูุฏ ุนุจุฏุงููู ุงูุญุณูู ุงูุทุงููุงูู ุงููุงุธูู",
            "grade": "ุงูุซุงูุซ ุงูุฅุนุฏุงุฏู ุงูุฃุฏุจู"
        },
        {
            "name": "ุฒููุจ ุงูุนุงุจุฏุฉ ุงูุตุงูุญุฉ ุงูุชููุฉ ุงููููุฉ ุงูุทุงูุฑุฉ",
            "grade": "ุงูุฑุงุจุน ุงูุนููู - ุดุนุจุฉ ุฃ"
        },
        {
            "name": "ุนูู ุญุณู ุทุงุฑู ุนุจุฏุงูุฑุญูู ุงูุฃูุตุงุฑู",
            "grade": "ุงูุฎุงูุณ ุงูุฃุฏุจู"
        }
    ]
    
    # ุฃุณูุงุก ูุฏุงุฑุณ ุทูููุฉ ููุนูุฏุฉ ููุงุฎุชุจุงุฑ
    complex_schools = [
        "ูุฏุฑุณุฉ ุงูุฅูุงู ุนูู ุจู ุฃุจู ุทุงูุจ (ุนููู ุงูุณูุงู) ุงููููุฐุฌูุฉ ููุจููู ูุงูุจูุงุช - ูุฑุน ุงููุฑุงุฏุฉ ุงูุดุฑููุฉ - ุงูููุทูุฉ ุงูุชุนููููุฉ ุงูุฃููู",
        "ุซุงูููุฉ ุงูุณูุฏุฉ ุฒููุจ ุงููุจุฑู (ุนูููุง ุงูุณูุงู) ููุจูุงุช ุงููุชูููุงุช ูุงูููููุจุงุช",
        "ุฅุนุฏุงุฏูุฉ ุงูุฅูุงู ุงูุญุณูู (ุนููู ุงูุณูุงู) ุงูุฃูููุฉ ุงููุฎุชูุทุฉ",
        "ูุฏุงุฑุณ ุงูุฑุณุงูุฉ ุงูุฅุณูุงููุฉ ุงููุชุทูุฑุฉ - ุงููุณู ุงูุงุจุชุฏุงุฆู ูุงููุชูุณุท",
        "ูุฌูุน ูุฏุงุฑุณ ุขู ุงูุจูุช (ุนูููู ุงูุณูุงู) ุงูุชุนูููู ุงููุชูุงูู"
    ]
    
    titles = [
        "ุจุทุงูุฉ ูููุฉ ุทุงูุจ/ุทุงูุจุฉ",
        "ูููุฉ ุทุงูุจ ูููุฐุฌู ูุชููู",
        "ุจุทุงูุฉ ุดุฎุตูุฉ ุชุนุฑูููุฉ",
        "ูุงุฑุช ูููุฉ ุงููุฏุฑุณุฉ ุงูุฃูููุฉ",
        "ุจุทุงูุฉ ุชุนุฑูู ุงูุทุงูุจ ุงูุฃูุงุฏูููุฉ"
    ]
    
    # ุฅูุดุงุก ูุฌูุฏ ูููุชุงุฆุฌ
    test_dir = Path("detailed_arabic_test")
    test_dir.mkdir(exist_ok=True)
    
    print(f"๐ ูุฌูุฏ ุงูุงุฎุชุจุงุฑ: {test_dir.absolute()}")
    
    successful_tests = 0
    total_tests = 0
    
    # ุงุฎุชุจุงุฑ 1: ูููุงุช ูุฑุฏูุฉ ููุญุต ุฏููู
    print("\n๐ ุงุฎุชุจุงุฑ 1: ูุนุงููุงุช ูุฑุฏูุฉ ูููุญุต ุงูุฏููู")
    
    for i, student in enumerate(complex_students):
        school = complex_schools[i % len(complex_schools)]
        title = titles[i % len(titles)]
        
        preview_file = test_dir / f"detailed_test_{i+1}.pdf"
        
        print(f"  {i+1}. ุงูุทุงูุจ: {student['name'][:50]}...")
        print(f"     ุงูุตู: {student['grade']}")
        print(f"     ุงููุฏุฑุณุฉ: {school[:60]}...")
        print(f"     ุงูุนููุงู: {title}")
        
        success = generate_single_student_id_preview(
            student,
            str(preview_file),
            school,
            title
        )
        
        total_tests += 1
        if success:
            successful_tests += 1
            size = preview_file.stat().st_size / 1024
            print(f"     โ ูุฌุญ ({size:.1f} KB)")
        else:
            print(f"     โ ูุดู")
        print()
    
    # ุงุฎุชุจุงุฑ 2: ูููุงุช ูุชุนุฏุฏุฉ ูู ุตูุญุฉ ูุงุญุฏุฉ
    print("๐ ุงุฎุชุจุงุฑ 2: ูููุงุช ูุชุนุฏุฏุฉ ูุน ูุตูุต ุทูููุฉ")
    
    multi_file = test_dir / "multiple_complex_ids.pdf"
    multi_success = generate_student_ids_pdf(
        complex_students,
        str(multi_file),
        complex_schools[0],  # ุฃุทูู ุงุณู ูุฏุฑุณุฉ
        titles[0]  # ุฃุทูู ุนููุงู
    )
    
    total_tests += 1
    if multi_success:
        successful_tests += 1
        size = multi_file.stat().st_size / 1024
        print(f"โ ูุฌุญ - ููู ูุชุนุฏุฏ ({size:.1f} KB)")
    else:
        print("โ ูุดู - ููู ูุชุนุฏุฏ")
    
    # ุงุฎุชุจุงุฑ 3: ูุตูุต ุฎุงุตุฉ (ุฃููุงุณุ ุฑููุฒุ ุฃุฑูุงู)
    print("\n๐ค ุงุฎุชุจุงุฑ 3: ูุตูุต ุฎุงุตุฉ ูุฑููุฒ")
    
    special_student = {
        "name": "ุนูู (ุฃุจู ุงูุญุณู) ุจู ุฃุจู ุทุงูุจ ุงููุงุดูู ุงููุฑุดู - 2025",
        "grade": "ุงูุตู ุงูู 6 ุงูุฅุนุฏุงุฏู (ุงูุนููู) - ุดุนุจุฉ A"
    }
    
    special_file = test_dir / "special_characters_test.pdf"
    special_success = generate_single_student_id_preview(
        special_student,
        str(special_file),
        "ูุฏุฑุณุฉ ุงูุฅูุงู ุนูู (ุน) - ูุฑุน #1 - ุณูุฉ 2025-2026",
        "ูููุฉ ุทุงูุจ/ุทุงูุจุฉ ูุนุชูุฏุฉ ุฑุณููุงู"
    )
    
    total_tests += 1
    if special_success:
        successful_tests += 1
        size = special_file.stat().st_size / 1024
        print(f"โ ูุฌุญ - ูุตูุต ุฎุงุตุฉ ({size:.1f} KB)")
    else:
        print("โ ูุดู - ูุตูุต ุฎุงุตุฉ")
    
    # ููุฎุต ุงููุชุงุฆุฌ
    print("\n" + "=" * 60)
    print("๐ ููุฎุต ุงูุงุฎุชุจุงุฑ ุงูุดุงูู:")
    print(f"โ ุงุฎุชุจุงุฑุงุช ูุงุฌุญุฉ: {successful_tests}")
    print(f"โ ุงุฎุชุจุงุฑุงุช ูุงุดูุฉ: {total_tests - successful_tests}")
    print(f"๐ ูุนุฏู ุงููุฌุงุญ: {(successful_tests/total_tests)*100:.1f}%")
    
    # ุนุฑุถ ุงููููุงุช ุงููููุดุฃุฉ
    if successful_tests > 0:
        created_files = list(test_dir.glob("*.pdf"))
        total_size = sum(f.stat().st_size for f in created_files) / 1024
        
        print(f"\n๐ ุงููููุงุช ุงููููุดุฃุฉ ({len(created_files)} ููู - {total_size:.1f} KB ุฅุฌูุงูู):")
        for f in created_files:
            size = f.stat().st_size / 1024
            print(f"  โข {f.name} ({size:.1f} KB)")
        
        # ูุญุงููุฉ ูุชุญ ุงููุฌูุฏ
        try:
            import subprocess
            subprocess.Popen(f'explorer "{test_dir.absolute()}"', shell=True)
            print(f"\n๐๏ธ  ุชู ูุชุญ ูุฌูุฏ ุงูุงุฎุชุจุงุฑ: {test_dir.absolute()}")
        except:
            print(f"\n๐ ููููู ูุชุญ ูุฌูุฏ ุงูุงุฎุชุจุงุฑ: {test_dir.absolute()}")
    
    # ุชูููู ุงูุฌูุฏุฉ
    if successful_tests == total_tests:
        print("\n๐ ููุชุงุฒ! ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช - ุฏุนู ุงูุนุฑุจูุฉ ูุซุงูู!")
        print("๐ค ุงููุต ุงูุนุฑุจู ููุนุฑุถ ุจุงูุดูู ุงูุตุญูุญ ูู ุฌููุน ุงูุญุงูุงุช")
        print("โจ ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ")
    elif successful_tests >= total_tests * 0.8:
        print(f"\nโ ุฌูุฏ ุฌุฏุงู! ูุนุธู ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช ({successful_tests}/{total_tests})")
        print("๐ง ูุฏ ุชุญุชุงุฌ ุจุนุถ ุงูุญุงูุงุช ุงูุฎุงุตุฉ ููุฑุงุฌุนุฉ")
    else:
        print(f"\nโ๏ธ  ูุญุชุงุฌ ุชุญุณูู - ูุฌุญ {successful_tests} ูู {total_tests} ุงุฎุชุจุงุฑ")
        print("๐๏ธ  ูุฑุงุฌุนุฉ ุฅุถุงููุฉ ูุทููุจุฉ ูุฏุนู ุงูุนุฑุจูุฉ")
    
    return successful_tests == total_tests

if __name__ == "__main__":
    print("๐ ุจุฏุก ุงูุงุฎุชุจุงุฑ ุงูุดุงูู ูุฏุนู ุงูุนุฑุจูุฉ ูู ุงููููุงุช")
    print("๐ก ูุฐุง ุงูุงุฎุชุจุงุฑ ููุญุต ุฌููุน ุนูุงุตุฑ ุงููุต ุงูุนุฑุจู ุจุฏูุฉ")
    
    success = test_all_text_elements()
    
    if success:
        print("\n๐ ุชู ุญู ุฌููุน ูุดุงูู ุฏุนู ุงูุนุฑุจูุฉ ุจูุฌุงุญ!")
        print("๐ ุงููุต ุงูุนุฑุจู ูุธูุฑ ุงูุขู ุจุงูุดูู ุงูุตุญูุญ ูู:")
        print("  โ ุฃุณูุงุก ุงูุทูุงุจ")  
        print("  โ ุฃุณูุงุก ุงููุฏุงุฑุณ")
        print("  โ ุงูุตููู ุงูุฏุฑุงุณูุฉ")
        print("  โ ุนูุงููู ุงููููุงุช")
        print("  โ ุงููุตูุต ุงูุซุงุจุชุฉ")
        print("  โ ุงููุฑุจุนุงุช ูุงูุชุณููุงุช")
    else:
        print("\n๐ง ูุง ุชุฒุงู ููุงู ุจุนุถ ุงูุชุญุณููุงุช ุงููุทููุจุฉ")
