# محرر القالب مع معاينة PDF لحظية 📄⚡

## الميزات الجديدة المطورة 🚀

### ✨ معاينة PDF لحظية حقيقية
- **معاينة PDF حقيقية**: ليس مجرد HTML، بل PDF فعلي كما سيظهر في الطباعة
- **تحديث لحظي**: تتحدث المعاينة تلقائياً عند تعديل أي إعداد
- **معالجة متوازية**: يتم توليد PDF في خيط منفصل لضمان استجابة سريعة للواجهة

### 🎛️ تحكم متقدم في المعاينة
- **تحديث تلقائي**: يمكن تفعيله/إيقافه حسب الحاجة
- **تحديث يدوي**: زر لفرض تحديث المعاينة فوراً
- **إشارات الحالة**: مؤشرات واضحة لحالة توليد وعرض PDF
- **شريط تقدم**: يظهر أثناء معالجة PDF

### 🔧 تحسينات تقنية
- **مولد PDF لحظي**: كلاس منفصل لتوليد PDF في الخلفية
- **إدارة ذكية للذاكرة**: تنظيف تلقائي للملفات المؤقتة
- **معالجة أخطاء محسنة**: رسائل واضحة عند حدوث مشاكل
- **أداء محسّن**: تأخير ذكي لتجنب التحديث المفرط

## كيفية الاستخدام 📖

### 1. تشغيل المحرر
```bash
python test_live_template_editor.py
```

### 2. استخدام المحرر
1. **افتح المحرر**: اضغط على زر "فتح محرر القالب"
2. **تحرير العناصر**: استخدم التبويبات على اليسار لتحرير عناصر الهوية
3. **مراقبة المعاينة**: شاهد التغييرات تظهر فوراً في معاينة PDF على اليمين
4. **تحكم في التحديث**: 
   - ✅ **تحديث تلقائي**: مفعل افتراضياً للتحديث اللحظي
   - 🔄 **تحديث يدوي**: لفرض تحديث المعاينة عند الحاجة

### 3. التحكم في المعاينة
- **⏳ جاري التحديث**: يظهر أثناء توليد PDF جديد
- **✅ PDF جاهز**: المعاينة محدثة وجاهزة للعرض
- **❌ خطأ**: في حالة مشكلة في التوليد مع تفاصيل الخطأ

## الملفات المحدثة 📁

### 1. `ui/dialogs/template_editor.py`
- **كلاس جديد**: `LivePDFGenerator` - لتوليد PDF في خيط منفصل
- **معاينة PDF**: استبدال معاينة HTML بمعاينة PDF حقيقية
- **تحكم تلقائي**: نظام ذكي للتحديث التلقائي مع تأخير
- **واجهة محسنة**: أزرار وإشارات حالة واضحة

### 2. `test_live_template_editor.py` (جديد)
- اختبار شامل للمحرر الجديد
- واجهة بسيطة لتجربة الميزات
- تعليمات مفصلة للاستخدام

## التقنيات المستخدمة 🛠️

### معاينة PDF لحظية
- **QWebEngineView**: لعرض PDF داخل التطبيق
- **QThread**: للمعالجة المتوازية وتجنب تجميد الواجهة
- **QTimer**: للتحديث المؤجل والذكي

### إدارة البيانات
- **TEMPLATE_ELEMENTS**: تطبيق التغييرات مؤقتاً للمعاينة
- **StudentIDGenerator**: استخدام مولد PDF الموجود
- **ملفات مؤقتة**: إدارة ذكية للمعاينات المتتالية

## مثال للاستخدام في الكود 💻

```python
from ui.dialogs.template_editor import TemplateEditor

# إنشاء وفتح المحرر
editor = TemplateEditor(parent_window)
result = editor.exec_()

if result == TemplateEditor.Accepted:
    # تم حفظ التغييرات
    print("تم تحديث قالب الهوية")
```

## الفوائد 🎯

### للمستخدم
- **معاينة دقيقة**: رؤية الهوية كما ستظهر في الطباعة الفعلية
- **تفاعل سريع**: تحديث فوري عند أي تعديل
- **تحكم مرن**: خيارات للتحديث التلقائي/اليدوي
- **واجهة واضحة**: إشارات وأزرار واضحة

### للمطور
- **كود منظم**: فصل منطق توليد PDF عن الواجهة
- **أداء محسن**: معالجة متوازية تمنع تجميد الواجهة
- **معالجة أخطاء**: نظام شامل للتعامل مع الأخطاء
- **قابلية التوسع**: سهولة إضافة ميزات جديدة

## ملاحظات تقنية 📝

### متطلبات النظام
- **PyQt5** مع **QWebEngineView** لعرض PDF
- **ReportLab** لتوليد PDF
- **مولد الهويات** الموجود في `core/pdf/student_id_generator.py`

### الأداء
- **تأخير ذكي**: ثانية واحدة بين التحديثات لتجنب الإفراط
- **معالجة منفصلة**: PDF يتولد في خيط منفصل
- **ذاكرة محسنة**: تنظيف تلقائي للملفات المؤقتة

### التطوير المستقبلي
- إضافة دعم للقوالب المخصصة في مولد PDF
- تحسين سرعة توليد PDF للمعاينة
- إضافة خيارات تكبير/تصغير للمعاينة
- دعم معاينة متعددة الصفحات

---

🎉 **تم تطوير محرر القالب ليوفر معاينة PDF لحظية حقيقية!**
