# تحديث نظام معاينة الأقساط

## التحديثات المطبقة

تم تطبيق التحديثات التالية لتحسين تجربة المستخدم عند إضافة الأقساط:

### ميزة المعاينة الداخلية للأقساط
- **النافذة الجديدة**: تم إنشاء `PDFPreviewDialog` لعرض إيصالات الأقساط داخل التطبيق
- **مزايا النافذة**:
  - معاينة PDF حقيقية داخل التطبيق باستخدام `QWebEngineView`
  - زر طباعة حقيقي يتصل بنظام الطباعة
  - واجهة عربية متكاملة
  - تصميم حديث ومريح للعين

### التحديثات المطبقة

#### 1. ملف `ui/widgets/pdf_preview_dialog.py` (جديد)
- نافذة معاينة PDF متكاملة
- دعم للطباعة الحقيقية عبر نظام التشغيل
- عرض احتياطي في حالة عدم توفر محرك الويب
- واجهة مستخدم عربية متجاوبة

#### 2. تحديث `core/printing/print_manager.py`
- تحديث دالة `_open_pdf_preview()` لاستخدام النافذة الداخلية
- إضافة دالة `_open_pdf_preview_external()` كخيار احتياطي
- تحسين معالجة الأخطاء

#### 3. تحديث `ui/widgets/__init__.py`
- إضافة استيراد النافذة الجديدة

### كيفية عمل النظام الجديد

1. **عند إضافة قسط جديد**:
   - يتم حفظ القسط في قاعدة البيانات
   - ينشئ النظام ملف PDF للإيصال
   - تفتح نافذة المعاينة الداخلية تلقائياً
   - يمكن للمستخدم المعاينة والطباعة من داخل التطبيق

2. **عند الضغط على زر طباعة في جدول الأقساط**:
   - ينشئ النظام إيصال PDF للقسط المحدد
   - تفتح نافذة المعاينة مع الإيصال
   - يمكن الطباعة المباشرة

### المتطلبات التقنية

- **محرك الويب**: يُفضل توفر `PyQt5.QtWebEngineWidgets` للمعاينة المثلى
- **بديل**: في حالة عدم التوفر، يعرض النظام خيارات فتح خارجي
- **نظام الطباعة**: يتكامل مع نظام طباعة Windows

### الفوائد للمستخدم

1. **سرعة العمل**: لا حاجة لفتح تطبيقات خارجية
2. **تحكم أفضل**: معاينة فورية قبل الطباعة
3. **واجهة موحدة**: كل شيء داخل التطبيق
4. **طباعة محسنة**: اتصال مباشر بطابعة النظام

### ملاحظات تقنية

- الملفات المؤقتة تُحفظ في `data/uploads/temp/`
- النظام يدعم العمل مع وبدون محرك الويب
- تصميم متجاوب يتكيف مع أحجام شاشات مختلفة
- معالجة شاملة للأخطاء المحتملة

---

**تاريخ التحديث**: أغسطس 2025  
**الإصدار**: 1.1.0  
**المطور**: GitHub Copilot
