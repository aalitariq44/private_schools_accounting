# ميزة طباعة إيصال الرسوم الإضافية

## نظرة عامة

تم إضافة ميزة جديدة لطباعة إيصالات الرسوم الإضافية للطلاب في نظام محاسبة المدارس الأهلية. هذه الميزة تسمح للمستخدم بطباعة إيصال شامل للرسوم الإضافية مع إمكانية اختيار الرسوم المراد تضمينها في الإيصال.

## الملفات المضافة

### 1. نافذة اختيار الرسوم للطباعة
**الملف:** `ui/pages/students/additional_fees_print_dialog.py`

نافذة حوار تتيح للمستخدم:
- اختيار الرسوم الإضافية المراد طباعتها
- تصفية الرسوم (جميع الرسوم / المدفوع فقط / غير المدفوع فقط)
- تحديد/إلغاء تحديد جميع الرسوم
- عرض ملخص الرسوم المحددة
- معاينة الإيصال قبل الطباعة

### 2. مدير طباعة الرسوم الإضافية
**الملف:** `core/printing/additional_fees_print_manager.py`

وحدة طباعة مخصصة تستخدم مكتبة ReportLab لإنشاء إيصالات احترافية تتضمن:
- دعم كامل للنصوص العربية (RTL + تشكيل الأحرف)
- تخطيط منظم مع جداول واضحة
- عرض وصلين في الصفحة الواحدة (مثل إيصال الأقساط)
- معلومات شاملة عن الطالب والرسوم
- ملخص مالي مفصل

### 3. ملف الاختبار
**الملف:** `test_additional_fees_print.py`

ملف اختبار شامل للتأكد من عمل الميزة بشكل صحيح.

## التحديثات على الملفات الموجودة

### تحديث صفحة تفاصيل الطالب
**الملف:** `ui/pages/students/student_details_page.py`

تم إضافة:
- زر "طباعة إيصال الرسوم" في قسم الرسوم الإضافية
- دالة `print_additional_fees_receipt()` لفتح نافذة الطباعة
- دالة `handle_fees_print_request()` لمعالجة طلبات الطباعة
- الاستيرادات المطلوبة للملفات الجديدة

## كيفية الاستخدام

### للمستخدم النهائي:

1. **الانتقال إلى صفحة تفاصيل الطالب**
   - اختر الطالب من قائمة الطلاب
   - انقر على "عرض التفاصيل"

2. **طباعة إيصال الرسوم الإضافية**
   - في قسم "الرسوم الإضافية"، انقر على زر "طباعة إيصال الرسوم"
   - ستظهر نافذة اختيار الرسوم

3. **تخصيص الإيصال**
   - **تصفية الرسوم:** اختر نوع الرسوم المراد عرضها:
     - جميع الرسوم (الافتراضي)
     - المدفوع فقط
     - غير المدفوع فقط
   
   - **اختيار الرسوم:** حدد الرسوم المراد تضمينها في الإيصال
     - بشكل افتراضي، جميع الرسوم محددة
     - يمكن إلغاء/تحديد رسوم فردية
     - استخدم "تحديد الجميع" لتحديد/إلغاء تحديد جميع الرسوم

4. **الطباعة**
   - **معاينة:** لعرض الإيصال قبل الطباعة
   - **طباعة:** لإنشاء الإيصال النهائي

## مواصفات الإيصال

### المحتوى
- **رأس الإيصال:** عنوان + اسم المدرسة + رقم الإيصال + تاريخ ووقت الطباعة
- **معلومات الطالب:** الاسم + الصف والشعبة
- **جدول الرسوم:** نوع الرسم + المبلغ + الحالة + تاريخ الدفع
- **الملخص المالي:** عدد الرسوم + المجموع الكلي + المدفوع + غير المدفوع
- **ذيل الإيصال:** ملاحظة محاسبية + مكان للتوقيع

### التصميم
- صفحة A4 مع هوامش 10mm
- وصلين متطابقين في الصفحة الواحدة
- خطوط عربية احترافية (Amiri أو Cairo)
- تلوين مميز للرسوم المدفوعة وغير المدفوعة
- تخطيط منظم وسهل القراءة

## المتطلبات التقنية

### مكتبات Python مطلوبة:
```
reportlab
arabic-reshaper
python-bidi
PyQt5
```

### الخطوط المطلوبة:
- خطوط Cairo (Cairo-Medium.ttf, Cairo-Bold.ttf)
- خطوط Amiri (Amiri.ttf, Amiri-Bold.ttf)

## اختبار الميزة

لاختبار الميزة الجديدة:

```bash
python test_additional_fees_print.py
```

هذا الاختبار سيقوم بـ:
- إنشاء بيانات تجريبية للرسوم الإضافية
- اختبار إنشاء إيصال الطباعة
- اختبار إنشاء معاينة الإيصال
- التحقق من وجود الملفات المُنشأة

## الميزات المستقبلية المقترحة

1. **تخصيص تخطيط الإيصال:** إمكانية تغيير تصميم الإيصال
2. **إضافة شعار المدرسة:** عرض شعار المدرسة في الإيصال
3. **تصدير لصيغ أخرى:** Excel, Word, إلخ
4. **طباعة مجمعة:** طباعة إيصالات متعددة في ملف واحد
5. **إعدادات طباعة متقدمة:** اختيار حجم الخط، الألوان، إلخ

## حل المشاكل الشائعة

### مشكلة الخطوط العربية
إذا لم تظهر النصوص العربية بشكل صحيح:
1. تأكد من وجود خطوط Cairo و Amiri في مجلد `app/resources/fonts/`
2. تحقق من تثبيت مكتبات `arabic-reshaper` و `python-bidi`

### مشكلة عدم ظهور الإيصال
إذا لم يتم إنشاء ملف الإيصال:
1. تحقق من صلاحيات الكتابة في مجلد `data/exports/prints/`
2. تأكد من تثبيت مكتبة `reportlab`

### مشكلة في نافذة الطباعة
إذا لم تظهر نافذة اختيار الرسوم:
1. تحقق من أن الطالب لديه رسوم إضافية
2. تأكد من تثبيت PyQt5 بشكل صحيح

## الدعم والتطوير

لأي استفسارات أو مشاكل متعلقة بهذه الميزة، يرجى مراجعة:
- ملفات السجل في مجلد `logs/`
- ملف الاختبار `test_additional_fees_print.py`
- التوثيق التقني في التعليقات داخل الكود
