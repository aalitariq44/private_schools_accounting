# تفاصيل الرواتب للمعلمين والموظفين - دليل المستخدم

## نظرة عامة
تمت إضافة ميزة جديدة لعرض تفاصيل رواتب المعلمين والموظفين مباشرة من صفحات إدارتهم. تتيح هذه الميزة للمستخدمين عرض سجل الرواتب وإضافة رواتب جديدة بسهولة.

## كيفية الوصول للميزة

### 1. من صفحة المعلمين
- انتقل إلى صفحة **المعلمين**
- **الضغط المزدوج**: اضغط ضغطتين سريعتين على أي معلم في الجدول
- **قائمة السياق**: اضغط بالزر الأيمن على المعلم واختر "عرض تفاصيل الرواتب"

### 2. من صفحة الموظفين
- انتقل إلى صفحة **الموظفين**
- **الضغط المزدوج**: اضغط ضغطتين سريعتين على أي موظف في الجدول
- **قائمة السياق**: اضغط بالزر الأيمن على الموظف واختر "عرض تفاصيل الرواتب"

## مكونات نافذة تفاصيل الرواتب

### الجانب الأيسر - جدول الرواتب السابقة
يعرض جميع الرواتب المسجلة للشخص المحدد مع الأعمدة التالية:
- **التاريخ**: تاريخ دفع الراتب
- **المبلغ**: المبلغ المدفوع فعلياً
- **الراتب الأساسي**: الراتب الأساسي المحدد
- **من تاريخ**: بداية فترة الراتب
- **إلى تاريخ**: نهاية فترة الراتب
- **عدد الأيام**: عدد أيام العمل
- **الملاحظات**: أي ملاحظات إضافية

### الجانب الأيمن - نموذج إضافة راتب جديد
يحتوي على الحقول التالية:
- **التاريخ**: تاريخ دفع الراتب (افتراضي: اليوم الحالي)
- **المبلغ المدفوع**: المبلغ الفعلي المدفوع (يحسب تلقائياً)
- **الراتب الأساسي**: الراتب الشهري الأساسي
- **من تاريخ**: بداية فترة العمل
- **إلى تاريخ**: نهاية فترة العمل
- **عدد الأيام**: يحسب تلقائياً أو يمكن إدخاله يدوياً
- **الملاحظات**: ملاحظات اختيارية

## الميزات الذكية

### 1. الحساب التلقائي للأيام
- عند تغيير "من تاريخ" أو "إلى تاريخ"، يتم حساب عدد الأيام تلقائياً
- الحساب يشمل اليوم الأول والأخير

### 2. الحساب التلقائي للراتب
- عند إدخال الراتب الأساسي وعدد الأيام، يتم حساب المبلغ المدفوع تلقائياً
- الحساب: (الراتب الأساسي ÷ 30) × عدد الأيام

### 3. التحقق من صحة البيانات
- التأكد من إدخال مبلغ مدفوع أكبر من صفر
- التأكد من إدخال راتب أساسي صحيح
- التأكد من إدخال عدد أيام صالح

## خطوات إضافة راتب جديد

1. **افتح نافذة تفاصيل الرواتب** (باستخدام إحدى الطرق المذكورة أعلاه)

2. **أدخل البيانات الأساسية**:
   - حدد تاريخ الدفع
   - أدخل الراتب الأساسي الشهري

3. **حدد فترة العمل**:
   - اختر "من تاريخ" و "إلى تاريخ"
   - سيتم حساب عدد الأيام تلقائياً
   - سيتم حساب المبلغ المدفوع تلقائياً

4. **أضف ملاحظات** (اختياري):
   - أدخل أي ملاحظات إضافية

5. **اضغط "إضافة راتب"**:
   - ستظهر رسالة تأكيد
   - اضغط "نعم" للتأكيد

6. **النتيجة**:
   - سيتم إضافة الراتب لقاعدة البيانات
   - سيتم تحديث جدول الرواتب فوراً
   - سيتم مسح النموذج تلقائياً

## أزرار التحكم

- **إضافة راتب**: لحفظ الراتب الجديد
- **تحديث**: لإعادة تحميل بيانات الرواتب
- **إغلاق**: لإغلاق النافذة

## التصميم والخط

- **حجم الخط**: 14 بكسل للوضوح
- **الألوان**: تدرج أزرق للمعلمين، أخضر للموظفين
- **التخطيط**: تقسيم أفقي بين الجدول والنموذج
- **التجاوب**: النافذة قابلة لتغيير الحجم

## ملاحظات مهمة

1. **النافذة مدمجة** مع نظام المراجعة الموجود
2. **البيانات محفوظة** في جدول الرواتب الموحد
3. **التحقق من الأمان** من صحة البيانات قبل الحفظ
4. **التسجيل الكامل** لجميع العمليات في سجل النشاطات
5. **دعم كامل للخط العربي** Cairo

## الملفات المضافة/المعدلة

### ملفات جديدة:
- `ui/pages/shared/salary_details_dialog.py` - نافذة تفاصيل الرواتب
- `ui/pages/shared/__init__.py` - ملف التهيئة للمجلد المشترك

### ملفات معدلة:
- `ui/pages/employees/employees_page.py` - إضافة الميزة لصفحة الموظفين
- `ui/pages/teachers/teachers_page.py` - إضافة الميزة لصفحة المعلمين

## استخدام قاعدة البيانات

النافذة تتعامل مع جدول `salaries` الموحد:
- `staff_type`: نوع الموظف ('teacher' أو 'employee')
- `staff_id`: معرف المعلم أو الموظف
- `base_salary`: الراتب الأساسي
- `paid_amount`: المبلغ المدفوع
- `from_date`: بداية فترة العمل
- `to_date`: نهاية فترة العمل
- `days_count`: عدد أيام العمل
- `payment_date`: تاريخ الدفع
- `notes`: الملاحظات
- `school_id`: معرف المدرسة

## الاختبار

تم اختبار الميزة بنجاح:
- ✅ فتح النافذة من صفحة المعلمين
- ✅ فتح النافذة من صفحة الموظفين  
- ✅ عرض الرواتب السابقة
- ✅ الحساب التلقائي للأيام
- ✅ الحساب التلقائي للمبلغ
- ✅ إضافة راتب جديد
- ✅ التحقق من صحة البيانات
- ✅ تسجيل العمليات في السجل
